# FMO 日志查看器

用于查看本地 FMO 日志的 Web 应用，支持多数据库文件加载和多种查询模式。

## ✨ 主要功能

### 📁 数据导入
- **桌面端**：授权访问本地目录，自动扫描所有 `.db` 文件
- **移动端**：支持直接选择多个 `.db` 文件（无需目录权限）
- **FMO 同步**：支持通过 WebSocket 实时同步 FMO 设备的今日通联记录
- 数据导入到 IndexedDB，刷新页面无需重新导入
- 按发送方呼号（fromCallsign）分类存储
- 智能去重：基于 UTC 日期 + 接收方呼号自动去重

### 📊 查询模式

#### 1. 查看所有
- 按日期倒序展示所有通联记录
- 支持按接收方呼号实时模糊搜索
- 分页展示（每页 100 条）
- **当日序号**：显示每条记录是当天第几个通联（基于 UTC 时间，每日从 1 开始计数）
  - 序号加粗显示，带背景色
  - 前 3 名使用金、银、铜色高亮显示
- 呼号与网格合并显示：接收方/发送方呼号下方换行显示对应网格
- 列顺序：日期、序号、接收方呼号、发送方呼号、频率、留言、模式、中继

#### 2. 通联排名（TOP20）
- **接收方呼号 TOP20**：统计最常通联的呼号
- **接收网格 TOP20**：统计最常通联的网格
- **中继名称 TOP20**：统计使用最多的中继（含管理员信息）
- 支持按发送方呼号筛选统计

#### 3. 老朋友
- 卡片布局展示所有通联过的呼号
- 显示通联次数、网格、首次/最新通联时间
- 今日通联显示绿色卡片，其他显示橙色（基于 UTC 时间）
- 支持呼号模糊搜索
- 点击卡片查看与该呼号的全部通联记录

### 💾 数据管理
- **FMO 配置**：支持 IP 地址或域名（如 fmo.local），支持 WebSocket 连通性校验（桌面浏览器默认预填充 fmo.local，移动浏览器隐藏 mDNS 提示）
- **日志备份**：一键备份（下载） FMO 设备上的所有日志文件
- **按呼号管理**：可选择特定发送方呼号查看数据
- **数据持久化**：IndexedDB 本地存储，刷新页面无需重新导入
- **清除数据**：支持清除所有缓存的数据
- 实时统计：显示总通联数和不重复呼号数

### 🎨 其他特性
- **暗色模式**：自动跟随系统主题切换，在暗色模式下提供舒适的阅读体验
- 使用 CDN 加载 SQLite WASM，优化首次加载速度
- 响应式设计，完美支持桌面和移动端访问
- 数据验证：自动验证 `.db` 文件有效性，跳过损坏文件

## 🚀 使用方法

### mDNS 支持
应用支持通过 mDNS 服务连接到 FMO 设备，可以直接使用 `fmo.local` 域名代替 IP 地址连接设备，无需手动查找 IP 地址。

在桌面浏览器中，默认会预填充 `fmo.local`，而在移动浏览器中则会隐藏 mDNS 提示，因为大多数移动设备不支持 mDNS 服务。

### 桌面端（Chrome/Edge）
1. 点击右上角设置图标
2. 点击“选择目录”，选择包含 `.db` 日志文件的目录
3. 授权后自动扫描、导入并显示日志
4. 数据会自动保存，下次访问无需重新导入

### 移动端/其他浏览器
1. 点击右上角设置图标
2. 点击“选择文件”，选择一个或多个 `.db` 文件
3. 自动导入并显示日志
4. 数据会自动保存，下次访问无需重新导入

### 数据管理
- **FMO 同步**：
    1. 在设置中输入 FMO 设备 IP 或域名（如 `192.168.1.100` 或 `fmo.local`）并点击保存（系统将自动校验连通性）
      - 桌面浏览器：默认预填充 `fmo.local`，可直接使用
      - 移动浏览器：隐藏 mDNS 提示，需手动输入 IP 地址
    2. 点击“同步今日通联”，应用将通过 WebSocket 获取今日最新的通联详情并保存至本地
- **日志备份**：点击“备份FMO日志”可直接下载设备端的日志备份文件
- **查看不同呼号**：在设置中选择不同的发送方呼号，切换数据源
- **添加新数据**：重复导入操作，新数据会自动合并（去重）
- **清除数据**：在设置中点击“清除所有数据”按钮

## 🛠️ 本地开发

```bash
# 安装依赖
npm install

# 启动开发服务器（支持局域网访问，方便手机测试）
npm run dev -- --host

# 代码格式化
npm run format

# 代码检查和修复
npm run lint
```

## 📦 构建部署

```bash
npm run build
```

构建产物位于 `dist/` 目录，可直接部署到任何静态文件服务器。

## 🌐 浏览器支持

- **推荐**：Chrome/Edge 最新版（支持 File System Access API，可选择目录）
- **兼容**：所有现代浏览器（通过文件选择器导入）
- **移动端**：iOS Safari、Android Chrome 等

## 📝 技术栈

- **框架**：Vue 3 + Vite
- **状态管理**：Pinia
- **数据库**：sql.js (SQLite WASM)
- **本地存储**：IndexedDB
- **路由**：Vue Router
- **代码规范**：ESLint + Prettier

## 💻 项目结构

```
FmoLogs/
├── src/
│   ├── components/     # Vue 组件
│   ├── router/         # 路由配置
│   ├── services/       # 核心业务逻辑
│   │   ├── db.js       # 数据库管理、查询、IndexedDB 存储
   │   └── fmoApi.js   # FMO 设备 WebSocket API 封装
│   ├── stores/         # Pinia 状态管理
│   ├── views/          # 页面组件
│   ├── App.vue         # 根组件
│   ├── main.js         # 入口文件
│   └── style.css       # 全局样式
├── package.json
├── vite.config.js
└── README.md
```
